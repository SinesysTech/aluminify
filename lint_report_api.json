[{"filePath":"E:\\Development\\aluminify\\app\\api\\atividade\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[914,917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[914,917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1004,1007],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1004,1007],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport {\r\n  atividadeService,\r\n  AtividadeNotFoundError,\r\n  AtividadeValidationError,\r\n} from \"@/backend/services/atividade\";\r\nimport { requireAuth, AuthenticatedRequest } from \"@/backend/auth/middleware\";\r\n\r\nconst serializeAtividade = (\r\n  atividade: Awaited<ReturnType<typeof atividadeService.getById>>,\r\n) => {\r\n  const a = atividade as Record<string, unknown>;\r\n  return {\r\n    id: a.id as string,\r\n    moduloId: (a.moduloId || a.modulo_id) as string,\r\n    tipo: a.tipo as string,\r\n    titulo: a.titulo as string,\r\n    arquivoUrl: (a.arquivoUrl || a.arquivo_url) as string,\r\n    gabaritoUrl: (a.gabaritoUrl || a.gabarito_url) as string,\r\n    linkExterno: (a.linkExterno || a.link_externo) as string,\r\n    obrigatorio: a.obrigatorio as boolean,\r\n    ordemExibicao: (a.ordemExibicao || a.ordem_exibicao) as number,\r\n    createdAt:\r\n      (a.createdAt as any)?.toISOString?.() || (a.created_at as string),\r\n    updatedAt:\r\n      (a.updatedAt as any)?.toISOString?.() || (a.updated_at as string),\r\n  };\r\n};\r\n\r\nfunction handleError(error: unknown) {\r\n  if (error instanceof AtividadeNotFoundError) {\r\n    return NextResponse.json({ error: error.message }, { status: 404 });\r\n  }\r\n\r\n  if (error instanceof AtividadeValidationError) {\r\n    return NextResponse.json({ error: error.message }, { status: 400 });\r\n  }\r\n\r\n  console.error(error);\r\n  return NextResponse.json({ error: \"Internal server error\" }, { status: 500 });\r\n}\r\n\r\ninterface RouteContext {\r\n  params: Promise<{ id: string }>;\r\n}\r\n\r\n// GET - Buscar atividade por ID\r\nexport async function GET(_request: NextRequest, context: RouteContext) {\r\n  try {\r\n    const params = await context.params;\r\n    const atividade = await atividadeService.getById(params.id);\r\n    return NextResponse.json({ data: serializeAtividade(atividade) });\r\n  } catch (error) {\r\n    return handleError(error);\r\n  }\r\n}\r\n\r\n// PATCH - Atualizar atividade (especialmente arquivo_url apÃ³s upload direto)\r\nasync function patchHandler(\r\n  request: AuthenticatedRequest,\r\n  params: { id: string },\r\n) {\r\n  if (\r\n    request.user &&\r\n    request.user.role !== \"professor\" &&\r\n    request.user.role !== \"superadmin\"\r\n  ) {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n  }\r\n\r\n  try {\r\n    const body = await request.json();\r\n\r\n    const atividade = await atividadeService.update(params.id, {\r\n      arquivoUrl: body?.arquivoUrl,\r\n      gabaritoUrl: body?.gabaritoUrl,\r\n      linkExterno: body?.linkExterno,\r\n      titulo: body?.titulo,\r\n      obrigatorio: body?.obrigatorio,\r\n      ordemExibicao: body?.ordemExibicao,\r\n    });\r\n\r\n    return NextResponse.json({ data: serializeAtividade(atividade) });\r\n  } catch (error) {\r\n    return handleError(error);\r\n  }\r\n}\r\n\r\nexport async function PATCH(request: NextRequest, context: RouteContext) {\r\n  const params = await context.params;\r\n  return requireAuth((req) => patchHandler(req, params))(request);\r\n}\r\n\r\nasync function deleteHandler(\r\n  request: AuthenticatedRequest,\r\n  params: { id: string },\r\n) {\r\n  if (\r\n    request.user &&\r\n    request.user.role !== \"professor\" &&\r\n    request.user.role !== \"superadmin\"\r\n  ) {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n  }\r\n\r\n  try {\r\n    await atividadeService.delete(params.id);\r\n    return NextResponse.json({ message: \"Atividade removida com sucesso\" });\r\n  } catch (error) {\r\n    return handleError(error);\r\n  }\r\n}\r\n\r\nexport async function DELETE(request: NextRequest, context: RouteContext) {\r\n  const params = await context.params;\r\n  return requireAuth((req) => deleteHandler(req, params))(request);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\Development\\aluminify\\app\\api\\atividade\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[887,890],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[887,890],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[977,980],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[977,980],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport {\r\n  atividadeService,\r\n  AtividadeValidationError,\r\n} from \"@/backend/services/atividade\";\r\nimport { requireAuth, AuthenticatedRequest } from \"@/backend/auth/middleware\";\r\n\r\nconst serializeAtividade = (\r\n  atividade: Awaited<ReturnType<typeof atividadeService.getById>>,\r\n) => {\r\n  const a = atividade as Record<string, unknown>;\r\n  return {\r\n    id: a.id as string,\r\n    moduloId: (a.moduloId || a.modulo_id) as string,\r\n    tipo: a.tipo as string,\r\n    titulo: a.titulo as string,\r\n    arquivoUrl: (a.arquivoUrl || a.arquivo_url) as string,\r\n    gabaritoUrl: (a.gabaritoUrl || a.gabarito_url) as string,\r\n    linkExterno: (a.linkExterno || a.link_externo) as string,\r\n    obrigatorio: a.obrigatorio as boolean,\r\n    ordemExibicao: (a.ordemExibicao || a.ordem_exibicao) as number,\r\n    createdAt:\r\n      (a.createdAt as any)?.toISOString?.() || (a.created_at as string),\r\n    updatedAt:\r\n      (a.updatedAt as any)?.toISOString?.() || (a.updated_at as string),\r\n  };\r\n};\r\n\r\nfunction handleError(error: unknown) {\r\n  if (error instanceof AtividadeValidationError) {\r\n    return NextResponse.json({ error: error.message }, { status: 400 });\r\n  }\r\n\r\n  console.error(error);\r\n  return NextResponse.json({ error: \"Internal server error\" }, { status: 500 });\r\n}\r\n\r\n// GET - Listar atividades (filtro por modulo_id ou frente_id)\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const moduloId = searchParams.get(\"modulo_id\");\r\n    const frenteId = searchParams.get(\"frente_id\");\r\n\r\n    let atividades;\r\n\r\n    if (moduloId) {\r\n      atividades = await atividadeService.listByModulo(moduloId);\r\n    } else if (frenteId) {\r\n      atividades = await atividadeService.listByFrente(frenteId);\r\n    } else {\r\n      return NextResponse.json(\r\n        { error: \"modulo_id or frente_id query parameter is required\" },\r\n        { status: 400 },\r\n      );\r\n    }\r\n\r\n    return NextResponse.json({ data: atividades.map(serializeAtividade) });\r\n  } catch (error) {\r\n    return handleError(error);\r\n  }\r\n}\r\n\r\nasync function postHandler(request: AuthenticatedRequest) {\r\n  if (\r\n    request.user &&\r\n    request.user.role !== \"professor\" &&\r\n    request.user.role !== \"superadmin\"\r\n  ) {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n  }\r\n\r\n  try {\r\n    const body = await request.json();\r\n    const atividade = await atividadeService.create({\r\n      moduloId: body?.modulo_id,\r\n      tipo: body?.tipo,\r\n      titulo: body?.titulo,\r\n      arquivoUrl: body?.arquivo_url,\r\n      gabaritoUrl: body?.gabarito_url,\r\n      linkExterno: body?.link_externo,\r\n      obrigatorio: body?.obrigatorio,\r\n      ordemExibicao: body?.ordem_exibicao,\r\n    });\r\n\r\n    return NextResponse.json(\r\n      { data: serializeAtividade(atividade) },\r\n      { status: 201 },\r\n    );\r\n  } catch (error) {\r\n    return handleError(error);\r\n  }\r\n}\r\n\r\nexport const POST = requireAuth(postHandler);\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\Development\\aluminify\\app\\api\\sessao\\finalizar\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[415,418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[415,418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport {\r\n  requireUserAuth,\r\n  AuthenticatedRequest,\r\n} from \"@/backend/auth/middleware\";\r\nimport {\r\n  sessaoEstudoService,\r\n  SessaoEstudoValidationError,\r\n  SessaoEstudoNotFoundError,\r\n} from \"@/backend/services/sessao-estudo\";\r\nimport { SessaoEstudo } from \"@/types/sessao-estudo\";\r\n\r\nfunction serialize(sessao: SessaoEstudo) {\r\n  const s = sessao as Record<string, any>;\r\n  return {\r\n    id: s.id,\r\n    aluno_id: s.aluno_id || s.alunoId,\r\n    disciplina_id: s.disciplina_id || s.disciplinaId,\r\n    frente_id: s.frente_id || s.frenteId,\r\n    modulo_id: s.modulo_id || s.moduloId,\r\n    atividade_relacionada_id:\r\n      s.atividade_relacionada_id || s.atividadeRelacionadaId,\r\n    inicio: s.inicio,\r\n    fim: s.fim,\r\n    tempo_total_bruto_segundos:\r\n      s.tempo_total_bruto_segundos || s.tempoTotalBrutoSegundos,\r\n    tempo_total_liquido_segundos:\r\n      s.tempo_total_liquido_segundos || s.tempoTotalLiquidoSegundos,\r\n    log_pausas: s.log_pausas || s.logPausas,\r\n    metodo_estudo: s.metodo_estudo || s.metodoEstudo,\r\n    nivel_foco: s.nivel_foco || s.nivelFoco,\r\n    status: s.status,\r\n    created_at: s.created_at || s.createdAt,\r\n  };\r\n}\r\n\r\nasync function handler(request: AuthenticatedRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const sessao = await sessaoEstudoService.finalizarSessao(request.user!.id, {\r\n      sessaoId: body?.sessao_id,\r\n      logPausas: body?.log_pausas ?? [],\r\n      fimIso: body?.fim ?? undefined,\r\n      nivelFoco: body?.nivel_foco ?? undefined,\r\n      status: body?.status ?? undefined,\r\n    });\r\n\r\n    return NextResponse.json({ data: serialize(sessao) });\r\n  } catch (error) {\r\n    if (error instanceof SessaoEstudoValidationError) {\r\n      return NextResponse.json({ error: error.message }, { status: 400 });\r\n    }\r\n    if (error instanceof SessaoEstudoNotFoundError) {\r\n      return NextResponse.json({ error: error.message }, { status: 404 });\r\n    }\r\n\r\n    console.error(\"[sessao/finalizar]\", error);\r\n    return NextResponse.json({ error: \"Erro interno\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport const PATCH = requireUserAuth(handler);\r\n","usedDeprecatedRules":[]}]
